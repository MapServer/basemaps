<html>
<head>
    <meta charset="UTF-8">
    <script src="js/lib/jquery/jquery-1.9.1.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css"/>
    <link rel="stylesheet" href="js/leaflet.zoomdisplay.css"/>
    <link rel="stylesheet" href="js/Leaflet.Coordinates.css"/>
    <link rel="stylesheet" href="js/leaflet.bookmarks.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-easybutton@2.0.0/src/easy-button.css">

    <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
    <script src="js/leaflet.wms.js"></script>
    <script src="js/TileLayer.Grayscale.js"></script>
    <script src="js/leaflet.zoomdisplay-src.js"></script>
    <script src="js/Leaflet.Coordinates.js"></script>
    <script src="js/Leaflet.Bookmarks.js"></script>
    <script src="https://unpkg.com/leaflet-easybutton@2.0.0/src/easy-button.js"></script>
    <style>
        #mapid {
            height: 100%;
            width: 100%;
        }
        .leaflet-tile-border {
            border-bottom: solid black 1px;
            border-right: solid black 1px;
        }
        .img-trans {
            opacity: 0.5;
            display: inline-block;
        }
    </style>
</head>
<body>
<div id="mapid"></div>
<script language="JavaScript">
    console.log('coucou');
    var url = '';
    var urlOrtho = '/map/?map=/Users/nicolas/Projets/i3dat/demo/map/';
    var urlTestEffi = 'http://preview.efficity.com:8101/cgi-bin/mapserv?map=/home/nicolas/labels_only_export/osm-google-labels-only.map';
    //platform-dependend url
    //platform-dependend url
    jQuery.ajaxSetup({async: false});
    var os = jQuery.get('php/os.php');
    os = os.responseText;
    jQuery.ajaxSetup({async: true});

    if (os === "Darwin") {
        url = '/cgi-bin/mapserv?map=/Users/nicolas/bin/mapserver-basemaps/';
        urlOrtho = '/cgi-bin/mapserv?map=/Users/nicolas/Projets/i3dat/demo/map/';

        // nginx urls
//        url = '/map/map=/Users/nicolas/bin/mapserver-basemaps/';
//        urlOrtho = '/map/?map=/Users/nicolas/Projets/i3dat/demo/map/';
    } else if (os === "Linux") {
        url = '/cgi-bin/mapserv?map=/home/ubuntu/apps/mapserver-basemaps/';
        urlOrtho = '/cgi-bin/mapserv?map=/Users/nicolas/Projets/i3dat/demo/map/';
    }

    var urlMapcache = '/mapcache-osm/tms/1.0.0/[LAYER]@GoogleMapsCompatible/{z}/{x}/{y}.png';
    var urlMapcache512 = '/mapcache-osm/tms/1.0.0/[LAYER]@GoogleMapsCompatible512/{z}/{x}/{y}.png';
    var urlS3 = 'http://efficity-basemap.s3.amazonaws.com/mapcache/[LAYER]/GoogleMapsCompatible/{z}/{x}/{y}.png';
    var urlS3512 = 'http://efficity-basemap.s3.amazonaws.com/mapcache/[LAYER]/GoogleMapsCompatible512/{z}/{x}/{y}.png';

    var map = L.map('mapid').setView(
//        [43.604, 1.40], 8
        [43.6447, 1.4557], 12
    );

    ////////////// OSM live TMS ////////////////////////////////////////////////////////////////////////////////////////
    var osmLayer = L.tileLayer('http://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        'errorTileUrl': 'image/tileerror.png',
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    });

    ////////////// Mapcache layers for Efficity Application ////////////////////////////////////////////////////////////

    ////////////// MapServer layers to test Mapserver available styles ////////////////////////////////////////////////////

    ////////////// S3 pure rest layers for Efficity Application ////////////////////////////////////////////////////////////
    // forces B&W by Leaflet plugin

    var emptyLayer = L.tileLayer('').addTo(map);
    var baseLayers = {
        'empty': emptyLayer,
        "OSM b&w ": osmLayer
    };
//    var overlays = getLayers('wms', map);
    var overlays = getLayers('classic', map);

    L.control.layers(baseLayers, overlays).addTo(map);

    // coordinates:
    L.control.coordinates().addTo(map);

    //custom button
    L.easyButton('<img id="imggrid" class="img-trans" width="18" height="18" src="image/grid.png">', function (btn, map) {
        $('.leaflet-tile').toggleClass('leaflet-tile-border');
        $('#imggrid').toggleClass('img-trans');
    }).addTo(map);

    // 21 juillet 2017: custom bookmarks to navigate to DROM
    var bookmarksControl = new L.Control.Bookmarks({
        localStorage: false // if you want to use local variable for storage
    }).addTo(map);

    // adds bookmarks: todo: smarter
    map.fire('bookmark:add', {
        data: {
            id: 'bm_guadeloupe',
            name: 'Guadeloupe',
            latlng: [16.26, -61.55],
            zoom: 10,
            removable: false,
            editable: false
        }
    });
    map.fire('bookmark:add', {
        data: {
            id: 'bm_martinique',
            name: 'Martinique',
            latlng: [14.6361, -61.0],
            zoom: 11,
            removable: false,
            editable: false
        }
    });
    map.fire('bookmark:add', {
        data: {
            id: 'bm_guyane',
            name: 'Guyane',
            latlng: [4.09, -53.13],
            zoom: 8,
            removable: false,
            editable: false
        }
    });
    map.fire('bookmark:add', {
        data: {
            id: 'bm_reunion',
            name: 'Réunion',
            latlng: [-21.11, 55.53],
            zoom: 10,
            removable: false,
            editable: false
        }
    });
    map.fire('bookmark:add', {
        data: {
            id: 'bm_mayotte',
            name: 'Mayotte',
            latlng: [-12.79, 45.16],
            zoom: 11,
            removable: false,
            editable: false
        }
    });
    map.fire('bookmark:add', {
        data: {
            id: 'bm_nouvellecaledonie',
            name: 'Nouvelle Calédonie',
            latlng: [-21.32, 165.5],
            zoom: 8,
            removable: false,
            editable: false
        }
    });
    map.fire('bookmark:add', {
        data: {
            id: 'bm_polynesie',
            name: 'Polynésie',
            latlng: [-16.96,-151.6],
            zoom: 7,
            removable: false,
            editable: false
        }
    });
    map.fire('bookmark:add', {
        data: {
            id: 'bm_wallisetfutuna',
            name: 'Wallis et Futuna',
            latlng: [-13.77345, -177.1532],
            zoom: 7,
            removable: false,
            editable: false
        }
    });
    map.fire('bookmark:add', {
        data: {
            id: 'bm_saintpierreetmiquelon',
            name: 'St Pierre et Miquelon',
            latlng: [47.03, -56.31],
            zoom: 11,
            removable: false,
            editable: false
        }
    });
    map.fire('bookmark:add', {
        data: {
            id: 'bm_saintmartin',
            name: 'St Martin',
            latlng: [18.0731, -63.0615],
            zoom: 11,
            removable: false,
            editable: false
        }
    });
    map.fire('bookmark:add', {
        data: {
            id: 'bm_saintbarthelemy',
            name: 'St Barthelemy',
            latlng: [17.90430, -62.8217],
            zoom: 11,
            removable: false,
            editable: false
        }
    });


    // TODO: why ?
    map.setView(
//        [43.604, 1.40], 8
        [43.6447, 1.4557], 12
    );

    // gets classic Leaflet wms tile layers
    function getClassicLayers(map) {
        var options = {
            layers: 'default',
            format: 'image/png',
            transparent: true,
            'errorTileUrl': 'image/tileerror.png',
            attribution: "&copy; OSM data"
        };

        var optionsTestEffi = {
//            layers: 'commune_label',
            layers: 'default',
            format: 'image/png',
//            tileSize: 512,
            transparent: true,
            'errorTileUrl': 'image/tileerror.png',
            attribution: "&copy; OSM data"
        };

        var tmsOptions = {
            'tms': true,
            'errorTileUrl': 'image/tileerror.png',
            attribution: "&copy; OSM data"
        };

        var tmsOptions512 = {
            'tms': true,
            tileSize: 512,
            'errorTileUrl': 'image/tileerror.png',
            attribution: "&copy; OSM data"
        };

        return {
            "S3 Google no labels": new L.TileLayer(urlS3.replace('[LAYER]', 'osm_google_no_labels_ts'), tmsOptions),
            "MC Google no labels": new L.TileLayer.Grayscale(urlMapcache.replace('[LAYER]', 'osm_google_no_labels_ts'), tmsOptions),
            "MS Default": L.tileLayer.wms(url + "osm-default.map", options),
            "MS Default+Symbols": L.tileLayer.wms(url + "osm-default-symbols.map", options),
            "MS Google": L.tileLayer.wms(url + "osm-google.map", options),
            "MS Google no labels": L.tileLayer.wms(url + "osm-google-no-labels.map", options),
            "MS Google+symbols": L.tileLayer.wms(url + "osm-google-buildings-symbols.map", options),
            "MS Bing": L.tileLayer.wms(url + "osm-bing.map", options),
            "MS Bing+symbols": L.tileLayer.wms(url + "osm-bing-buildings-symbols.map", options),
            "MS Michelin": L.tileLayer.wms(url + "osm-michelin.map", options),
            "MS Micheling+symbols": L.tileLayer.wms(url + "osm-michelin-buildings-symbols.map", options),
            "MS Google Grayscale": L.tileLayer.wms(url + "osm-grayscale.map", options),
            "MS Google no labels grayscale": L.tileLayer.wms(url + "osm-google-no-labels-grayscale.map", options),
            "MS Google labels only": L.tileLayer.wms(url + "osm-google-labels-only.map", options),
            "MS OSM Symbols only": L.tileLayer.wms(url + "osm-symbols-only.map", options),
            "MC Google labels only":  new L.TileLayer(urlMapcache.replace('[LAYER]', 'osm_google_labels_only_ts'), tmsOptions),
            "MC OSM Symbols only": new L.TileLayer(urlMapcache.replace('[LAYER]', 'osm_symbols_only_ts'), tmsOptions),
            "MC Google no labels grayscale": new L.TileLayer(urlMapcache512.replace('[LAYER]', 'osm_google_no_labels_grayscale_NEW_ts'), tmsOptions512).addTo(map),
            "S3 Google labels only": new L.TileLayer(urlS3.replace('[LAYER]', 'osm_google_labels_only_ts'), tmsOptions),
            "S3 OSM Symbols only": new L.TileLayer(urlS3.replace('[LAYER]', 'osm_symbols_only_ts'), tmsOptions),
            "S3 Google Grayscale": new L.TileLayer(urlS3.replace('[LAYER]', 'osm_google_no_labels_grayscale_ts'), tmsOptions),
            "S3 Google NEW Grayscale": new L.TileLayer(urlS3512.replace('[LAYER]', 'osm_google_no_labels_grayscale_NEW_ts'), tmsOptions512),
            "MS test sqllite": new L.tileLayer.wms(urlOrtho + "ortho.map", options),
            "MC test labels effi": new L.tileLayer.wms(urlTestEffi, optionsTestEffi)
        };
    }

    // gets WMS.layer, single tiled
    function getWmsLayers(map) {
        var tmsOptions = {
            'tms': true,
            'errorTileUrl': 'image/tileerror.png',
            attribution: "&copy; OSM data"
        };
        var googleSymbolsL = L.WMS.overlay(url + "osm-google-buildings-symbols.map", {'transparent': true,'layers': 'default','format': 'png'});
        var defaultL =  L.WMS.overlay(url + "osm-default.map", {'transparent': true,'layers': 'default','format': 'png'});
        var defaultSymbolsL =  L.WMS.overlay(url + "osm-default-symbols.map", {'transparent': true,'layers': 'default','format': 'png'});
        var googleL = L.WMS.overlay(url + "osm-google.map", {'transparent': true,'layers': 'default','format': 'png'});
        var googleNoLabelsL = L.WMS.overlay(url + "osm-google-no-labels.map", {'transparent': true,'layers': 'default','format': 'png'});
        var bingL = L.WMS.overlay(url + "osm-bing.map", {'transparent': true,'layers': 'default','format': 'png'});
        var bingBuildingsSymbolsL = L.WMS.overlay(url + "osm-bing-buildings-symbols.map", {'transparent': true,'layers': 'default','format': 'png'});
        var michelinL = L.WMS.overlay(url + "osm-michelin.map", {'transparent': true,'layers': 'default','format': 'png'});
        var michelinBuildingsSymbolsL = L.WMS.overlay(url + "osm-michelin-buildings-symbols.map", {'transparent': true,'layers': 'default','format': 'png'});
        var grayscaleL = L.WMS.overlay(url + "osm-grayscale.map", {'transparent': true,'layers': 'default', format: 'png'});
        var grayscaleNoLabelsL = L.WMS.overlay(url + "osm-google-no-labels-grayscale.map", {'transparent': true,'layers': 'default', format: 'png'});
        var googleLabelsOnlyL = L.WMS.overlay(url + "osm-google-labels-only.map", {'transparent': true,'layers': 'default','format': 'png'});
        var symbolsOnlyL = L.WMS.overlay(url + "osm-symbols-only.map", {'transparent': true,'layers': 'default','format': 'png'});
        googleSymbolsL.addTo(map);
//        bingBuildingsSymbolsL.addTo(map);
//        bingL.addTo(map);

        return {
            "MC Google no labels": new L.TileLayer.Grayscale(urlMapcache.replace('[LAYER]', 'osm_google_no_labels_ts'), tmsOptions),
            "MS Default": defaultL,
            "MS Default+Symbols": defaultSymbolsL,
            "MS Google": googleL,
            "MS Google no labels": googleNoLabelsL,
            "MS Google+symbols": googleSymbolsL,
            "MS Bing": bingL,
            "MS Bing+symbols": bingBuildingsSymbolsL,
            "MS Michelin": michelinL,
            "MS Micheling+symbols": michelinBuildingsSymbolsL,
            "MS Google Grayscale": grayscaleL,
            "MS Google no labels Grayscale": grayscaleNoLabelsL,
            "MS Google labels only": googleLabelsOnlyL,
            "MS OSM Symbols only": symbolsOnlyL,
            "MC Google labels only":  new L.TileLayer(urlMapcache.replace('[LAYER]', 'osm_google_labels_only_ts'), tmsOptions),
            "MC OSM Symbols only": new L.TileLayer(urlMapcache.replace('[LAYER]', 'osm_symbols_only_ts'), tmsOptions),
            "S3 Google no labels": new L.TileLayer(urlS3.replace('[LAYER]', 'osm_google_no_labels_ts'), tmsOptions),
            "S3 Google labels only": new L.TileLayer(urlS3.replace('[LAYER]', 'osm_google_labels_only_ts'), tmsOptions),
            "S3 Google no labels Grayscale": new L.TileLayer(urlS3.replace('[LAYER]', 'osm_google_no_labels_grayscale_ts'), tmsOptions),
            "S3 OSM Symbols only": new L.TileLayer(urlS3.replace('[LAYER]', 'osm_symbols_only_ts'), tmsOptions)
        };
    }

    function getLayers(type, map) {
        return type === 'classic' ? getClassicLayers(map) : getWmsLayers(map);
    }

</script>
</body>
</html>